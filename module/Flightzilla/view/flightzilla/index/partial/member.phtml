<?php
$aTimes = $this->collectiontime($this->aStack);
?>
<div class="row-fluid memberBox">
    <div class="span12 well">
        <div class="span2">
            <a href="#" class="thumbnail">
                <?php
                    echo $this->gravatar($this->oResourceManager->getResource($this->sMemberName)->getGravatar(), array(
                            'imgSize' => 90,
                            'secure' => true
                        ),
                        array(
                            'class' => 'avatar',
                            'title' => $this->sMemberName
                        ));
                ?>
            </a>
            <?php echo sprintf('<h5><strong>%s</strong></h5>', $this->sMemberName); ?>
        </div>
        <div class="span10">
            <div class="row-fluid">
                <div class="span3">
                    <blockquote>
                        <p><?php echo $aTimes['spent'];?>h (<?php echo $aTimes['esti']; ?>h est.) <i class="icon-time"></i> <?php echo $aTimes['left']; ?>h (<?php echo $aTimes['days']; ?>d)</p>
                    </blockquote>
                </div>
                <div class="span9">
                    <div class="progress progress-<?php echo $aTimes['color'];?> progress-striped">
                        <div class="bar" style="width: <?php echo $aTimes['future']; ?>%"></div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <?php
                $aPins = array(
                    'active' => '',
                    'pending' => '',
                    'not' => ''
                );

                $iShowed = 0;
                foreach ($this->aStack as $this->oTicket) {
                    $sRender = $this->render('flightzilla/kanban/partial/pin.phtml');
                    if ($this->oTicket->isWip() === true) {
                        $aPins['active'] .= $sRender;
                    }
                    elseif ($iShowed++ < 9) {
                        $aPins['pending'] .= $sRender;
                    }
                    else {
                        $aPins['not'] .= $sRender;
                    }
                }
                ?>
                <div class="span2">
                    <img alt="lazy" src="<?php echo $this->basePath() . '/img/lazy.png'; ?>" class="<?php echo (empty($aPins['active']) === true) ? '' : 'hidden'; ?>" />
                    <?php echo $aPins['active']; ?>
                </div>
                <div class="span1 relative-box">
                    <strong class="largeGray"><?php echo count($this->aStack);?> <br/> ...</strong>
                </div>
                <div class="span9 pending">
                    <?php echo $aPins['pending']; ?>
                    <div class="hidden allTickets">
                        <?php echo $aPins['not']; ?>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
